{% comment %}<script src="{{ site.assets }}/js/plugins.js?{{ 'now' | date: '%Y%m%d-%H%M' }}"></script>{% endcomment %}
<script src="{{ site.assets }}/js/main.js?{{ 'now' | date: '%Y%m%d-%H%M' }}"></script>

{% if page.is-home %}
<script src="https://www.google.com/recaptcha/api.js"></script>
<script>
  /**
   * Opens the specified URL in a new browser tab or window.
   *
   * @param {string} url - The URL to open.
   * @param {string} windowName - The name of the new window.
   * @return {Window} The newly opened window.
   */
  function openInNewTab(url, windowName) {
    const newWindow = window.open(url, windowName);
    newWindow.focus();
    return newWindow;
  }

  /**
   * Makes an AJAX request to the specified URL using the provided method and data.
   *
   * @param {string} method - The HTTP method for the request (e.g., 'GET', 'POST').
   * @param {string} url - The URL to which the request is made.
   * @param {Object} data - The data to be sent with the request (e.g., JSON object, FormData).
   * @returns {Promise} A Promise that resolves to the response data from the server.
   * @throws {Error} If the network response is not OK or if there is an error during the fetch operation.
   */
  function ajax(method, url, data) {
    return fetch(url, {
      method,
      body: data,
      headers: {
        Accept: 'application/json',
      },
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .catch((error) => {
        throw new Error(
          `There was a problem with the fetch operation: ${error.message}`
        );
      });
  }

  /**
   * Initializes the form submission handling.
   */
  window.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('form-contact');
    const button = document.getElementById('form-contact-button');
    const status = document.getElementById('form-contact-status');

    /**
     * Handles the form submission success.
     */
    function handleSuccess() {
      form.reset();
      button.className = 'btn is-primary is-disabled';
      status.innerHTML = '{{ site.data.home.form-contact.thanks[page.lang] }}';
    }

    /**
     * Handles the form submission error.
     */
    function handleError() {
      status.innerHTML = '{{ site.data.home.form-contact.error[page.lang] }}';
    }

    /**
     * Handles the form submission.
     *
     * @param {Event} ev - The submit event.
     */
    function handleSubmit(ev) {
      ev.preventDefault();
      const data = new FormData(form);
      ajax(form.method, form.action, data)
        .then(() => handleSuccess())
        .catch(() => handleError());
    }

    form?.addEventListener('submit', handleSubmit);
  });

  function onSubmit(token) {
    document.getElementById('form-contact').submit();
  }


  /**
   * Start the animation of the hero when his background pictures are loaded
   */
  window.addEventListener('load', () => {
  const el = document.getElementById('hero');

  const getBackgroundImageUrls = (element) => {
    const styles = window.getComputedStyle(element);
    const { backgroundImage } = styles;

    if (!backgroundImage || backgroundImage === 'none') return [];

    // Extract URLs from the background-image style
    const urls = backgroundImage
      .match(/url\((['"])?(.*?)\1\)/gi)
      .map((match) => {
        return match.slice(4, -1).replace(/["']/g, '');
      });

    return urls;
  };

  const preloadImages = (urls) => {
    return Promise.all(
      urls.map((url) => {
        return new Promise((resolve, reject) => {
          const img = new Image();
          img.src = url;
          img.onload = resolve;
          img.onerror = reject;
        });
      })
    );
  };

  const checkAndAnimate = async (element) => {
    const urls = getBackgroundImageUrls(element);
    if (urls.length > 0) {
      await preloadImages(urls);
    }
    element.classList.add('is-animated');
  };

  checkAndAnimate(el);
});
</script>
<script type="module" src="{{ site.assets }}/js/animation.js"></script>
{% endif %}

<div id="fb-root"></div>
<script crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v5.0&appId=1477564732401123&autoLogAppEvents=1" nonce="rndxRhrD"></script>
